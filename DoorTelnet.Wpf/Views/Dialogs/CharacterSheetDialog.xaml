<Window x:Class="DoorTelnet.Wpf.Views.Dialogs.CharacterSheetDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:DoorTelnet.Wpf.Views.Dialogs"
        Title="Character Sheet" Height="660" Width="880" Background="{StaticResource Brush.Background}" Foreground="{StaticResource Brush.Text}" WindowStartupLocation="CenterOwner">
    <Window.Resources>
        <Style x:Key="SelectAllOnFocusTextBox" TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
            <EventSetter Event="GotKeyboardFocus" Handler="TextBox_SelectAll" />
            <EventSetter Event="PreviewMouseLeftButtonDown" Handler="TextBox_PreviewMouseLeftButtonDown" />
        </Style>
    </Window.Resources>
    <Grid Margin="8">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <TextBlock FontSize="20" FontWeight="Bold" Text="Character" Margin="0,0,0,8" />
                <WrapPanel Margin="0,0,0,12">
                    <StackPanel Margin="0,0,28,0">
                        <TextBlock Text="Name" FontWeight="Bold"/>
                        <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="SemiBold"/>
                    </StackPanel>
                    <StackPanel Margin="0,0,28,0">
                        <TextBlock Text="Class" FontWeight="Bold"/>
                        <TextBlock Text="{Binding Class}" FontSize="14" FontWeight="SemiBold"/>
                    </StackPanel>
                </WrapPanel>

                <GroupBox Header="Automation" Margin="0,0,0,12">
                    <StackPanel Margin="6" Orientation="Vertical">
                        <WrapPanel>
                            <CheckBox Content="Auto Shield" IsChecked="{Binding AutoShield}" Margin="4"
                                      ToolTip="Automatically casts shield spells when shield effect expires"/>
                            <CheckBox Content="Auto Heal" IsChecked="{Binding AutoHeal}" Margin="4"
                                      ToolTip="Automatically casts healing spells when HP drops below configured threshold"/>
                            <CheckBox Content="Auto Gong" IsChecked="{Binding AutoGong}" Margin="4"
                                      ToolTip="Automatically rings the gong to summon monsters, attacks them, and loots gold/silver. Requires sufficient HP to operate safely"/>
                            <CheckBox Content="Auto Attack" IsChecked="{Binding AutoAttack}" Margin="4"
                                      ToolTip="Automatically attacks aggressive monsters in the current room. Works independently of Auto Gong"/>
                            <CheckBox Content="Pickup Gold" IsChecked="{Binding PickupGold}" Margin="4"
                                      ToolTip="Automatically picks up gold coins when they appear"/>
                            <CheckBox Content="Pickup Silver" IsChecked="{Binding PickupSilver}" Margin="4"
                                      ToolTip="Automatically picks up silver coins when they appear"/>
                        </WrapPanel>
                        <UniformGrid Columns="3" Margin="4,8,4,0">
                            <StackPanel Margin="4">
                                <TextBlock Text="Shield Refresh (sec)" FontSize="11" 
                                          ToolTip="Minimum time between shield casting attempts"/>
                                <TextBox Text="{Binding ShieldRefreshSec, UpdateSourceTrigger=PropertyChanged}" Width="90" Style="{StaticResource SelectAllOnFocusTextBox}" PreviewTextInput="NumericOnly" />
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock Text="Gong HP %" FontSize="11"
                                          ToolTip="Minimum HP percentage required to continue gong automation cycle"/>
                                <TextBox Text="{Binding GongMinHpPercent, UpdateSourceTrigger=PropertyChanged}" Width="90" Style="{StaticResource SelectAllOnFocusTextBox}" PreviewTextInput="NumericOnly" />
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock Text="Auto Heal HP %" FontSize="11"
                                          ToolTip="HP percentage threshold for automatic healing"/>
                                <TextBox Text="{Binding AutoHealHpPercent, UpdateSourceTrigger=PropertyChanged}" Width="90" Style="{StaticResource SelectAllOnFocusTextBox}" PreviewTextInput="NumericOnly" />
                            </StackPanel>
                        </UniformGrid>
                        <UniformGrid Columns="3" Margin="4,4,4,0">
                            <StackPanel Margin="4">
                                <TextBlock Text="Warning Heal HP %" FontSize="11"
                                          ToolTip="HP percentage that stops gong and waits for timers before healing"/>
                                <TextBox Text="{Binding WarningHealHpPercent, UpdateSourceTrigger=PropertyChanged}" Width="90" Style="{StaticResource SelectAllOnFocusTextBox}" PreviewTextInput="NumericOnly" />
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock Text="Critical HP %" FontSize="11"
                                          ToolTip="Critical HP percentage for emergency actions"/>
                                <TextBox Text="{Binding CriticalHpPercent, UpdateSourceTrigger=PropertyChanged}" Width="90" Style="{StaticResource SelectAllOnFocusTextBox}" PreviewTextInput="NumericOnly" />
                            </StackPanel>
                            <StackPanel Margin="4">
                                <TextBlock Text="Critical Action" FontSize="11"
                                          ToolTip="Action to take when critical HP is reached: stop, disconnect, or custom script"/>
                                <ComboBox SelectedItem="{Binding CriticalAction, UpdateSourceTrigger=PropertyChanged}" 
                                          ItemsSource="{Binding CriticalActionOptions}"
                                          Width="90" 
                                          IsEditable="True"
                                          IsTextSearchEnabled="False"
                                          ToolTip="Select or enter custom action: stop, disconnect, or script:{your_command}"/>
                            </StackPanel>
                        </UniformGrid>
                    </StackPanel>
                </GroupBox>

                <Grid Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="3*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Text="Heals" FontWeight="Bold" Grid.Column="0"/>
                    <TextBlock Text="Shields" FontWeight="Bold" Grid.Column="1"/>
                    <TextBlock Text="Inventory" FontWeight="Bold" Grid.Column="2"/>

                    <ListBox Grid.Row="1" Grid.Column="0" ItemsSource="{Binding Heals}" Height="140" Background="#202429" BorderBrush="#333">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <DockPanel Margin="2">
                                    <TextBlock Text="{Binding Short}" FontWeight="Bold" Foreground="#5EC6FF" Margin="0,0,6,0"/>
                                    <TextBlock Text="{Binding Spell}" Margin="0,0,6,0"/>
                                    <TextBlock Text="x" Margin="0,0,4,0"/>
                                    <TextBlock Text="{Binding Heals}"/>
                                </DockPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    <ListBox Grid.Row="1" Grid.Column="1" ItemsSource="{Binding Shields}" Height="140" Background="#202429" BorderBrush="#333"/>
                    <ListBox Grid.Row="1" Grid.Column="2" ItemsSource="{Binding Inventory}" Height="140" Background="#202429" BorderBrush="#333"/>
                </Grid>

                <GroupBox Header="Spells" Margin="0,0,0,12">
                    <DataGrid ItemsSource="{Binding Spells}" AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True" RowHeaderWidth="0" FontSize="12" HeadersVisibility="Column" Background="{StaticResource Brush.Panel}" Foreground="{StaticResource Brush.Text}" BorderBrush="{StaticResource Brush.Border}" RowBackground="#262626" AlternatingRowBackground="#303030" MinHeight="240" Height="Auto">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Nick" Binding="{Binding Nick}" Width="80"/>
                            <DataGridTextColumn Header="Name" Binding="{Binding LongName}" Width="*"/>
                            <DataGridTextColumn Header="Sphere" Binding="{Binding Sphere}" Width="100"/>
                            <DataGridTextColumn Header="Mana" Binding="{Binding Mana}" Width="70"/>
                            <DataGridTextColumn Header="Diff" Binding="{Binding Diff}" Width="70"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,8">
                    <Button Content="Close" Command="{Binding CloseCommand}" Width="100"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Window>